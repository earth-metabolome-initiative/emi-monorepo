# Use the official PostgreSQL image from the Docker Hub
FROM postgres:17

# Install PostGIS
RUN apt-get update && \
    apt-get install -y postgis postgresql-17-postgis-3 postgresql-17-cron tmux

# First, we copy the `pgrx_validation` extension files to the image
COPY ./web_common/pgrx_validation/extension/usr/lib/postgresql/17/lib/pgrx_validation.so /usr/lib/postgresql/17/lib/pgrx_validation.so
COPY ./web_common/pgrx_validation/extension/usr/share/postgresql/17/extension/pgrx_validation.control /usr/share/postgresql/17/extension/pgrx_validation.control
COPY ./web_common/pgrx_validation/extension/usr/share/postgresql/17/extension/pgrx_validation--0.0.0.sql usr/share/postgresql/17/extension/pgrx_validation--0.0.0.sql

# Next, we copy the the `iso_codes` extension files to the image
COPY ./web_common/iso_codes/extension/usr/lib/postgresql/17/lib/iso_codes.so /usr/lib/postgresql/17/lib/iso_codes.so
COPY ./web_common/iso_codes/extension/usr/share/postgresql/17/extension/iso_codes.control /usr/share/postgresql/17/extension/iso_codes.control
COPY ./web_common/iso_codes/extension/usr/share/postgresql/17/extension/iso_codes--0.1.0.sql usr/share/postgresql/17/extension/iso_codes--0.1.0.sql

# Next, we copy the the `tool_categories` extension files to the image
COPY ./web_common/tool_categories/extension/usr/lib/postgresql/17/lib/tool_categories.so /usr/lib/postgresql/17/lib/tool_categories.so
COPY ./web_common/tool_categories/extension/usr/share/postgresql/17/extension/tool_categories.control /usr/share/postgresql/17/extension/tool_categories.control
COPY ./web_common/tool_categories/extension/usr/share/postgresql/17/extension/tool_categories--0.1.0.sql usr/share/postgresql/17/extension/tool_categories--0.1.0.sql

# Next, we copy the the `instrument_categories` extension files to the image
COPY ./web_common/instrument_categories/extension/usr/lib/postgresql/17/lib/instrument_categories.so /usr/lib/postgresql/17/lib/instrument_categories.so
COPY ./web_common/instrument_categories/extension/usr/share/postgresql/17/extension/instrument_categories.control /usr/share/postgresql/17/extension/instrument_categories.control
COPY ./web_common/instrument_categories/extension/usr/share/postgresql/17/extension/instrument_categories--0.1.0.sql usr/share/postgresql/17/extension/instrument_categories--0.1.0.sql

# Next, we copy the the `nameplate_categories` extension files to the image
COPY ./web_common/nameplate_categories/extension/usr/lib/postgresql/17/lib/nameplate_categories.so /usr/lib/postgresql/17/lib/nameplate_categories.so
COPY ./web_common/nameplate_categories/extension/usr/share/postgresql/17/extension/nameplate_categories.control /usr/share/postgresql/17/extension/nameplate_categories.control
COPY ./web_common/nameplate_categories/extension/usr/share/postgresql/17/extension/nameplate_categories--0.1.0.sql usr/share/postgresql/17/extension/nameplate_categories--0.1.0.sql

# Next, we copy the the `container_categories` extension files to the image
COPY ./web_common/container_categories/extension/usr/lib/postgresql/17/lib/container_categories.so /usr/lib/postgresql/17/lib/container_categories.so
COPY ./web_common/container_categories/extension/usr/share/postgresql/17/extension/container_categories.control /usr/share/postgresql/17/extension/container_categories.control
COPY ./web_common/container_categories/extension/usr/share/postgresql/17/extension/container_categories--0.1.0.sql usr/share/postgresql/17/extension/container_categories--0.1.0.sql